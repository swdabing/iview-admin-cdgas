<!DOCTYPE html>
<!--
http://localhost/download/pms.html?itemNo=CD19F078
http://swdabing.gitee.io/cinp/pms?itemNo=CD19F078
-->
<html>
<head>
<meta charset="utf-8">
<title>pms</title>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
</script>
<script>
$(document).ready(function(){
	if(getUrlParam("itemNo")==null||getUrlParam("itemNo")==""){
		$("#div").html('参数不全');
		return;
	}
	retQueryResultList(getUrlParam("itemNo"));
});

//获取url中的参数
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
	
let retQueryResultList = function(itemNo){
		var url='http://mapp.crcgas.com:18001/process/notify/crcgas_cis@fiberhome/query?username=LIUZHIBING5&password=Liuzhibing5&url=/md_cd_accbly/commQuery/queryResultList&data={"orgNo":"1111","itemNo":"'
			+itemNo+'"}';
		$.ajax({
			url : url,
			type : 'get',
			async: false,//使用同步的方式,true为异步方式
			success : function(data){
				//$("#div").html(JSON.stringify(data));
				retPmsload(data)
			},
			fail:function(){
			},
		})
}
let retPmsload = function(retQueryResultList){
	var url='http://mapp.crcgas.com:18001/process/notify/crcgas_cis@fiberhome/query?username=LIUZHIBING5&password=Liuzhibing5&url=/md_cd_buacpt/buacpt/load&isUrlParam=1&appNo='
			+retQueryResultList.resultValue.items[0].appNo;
		$.ajax({
			url : url,
			type : 'get',
			async: false,//使用同步的方式,true为异步方式
			success : function(data){
				//$("#div").html(JSON.stringify(data));
				retShowStaffInfoById(data,retQueryResultList)
			},
			fail:function(){
			},
		})
}

let retShowStaffInfoById = function(retPmsload,retQueryResultList){
	var url='http://mapp.crcgas.com:18001/process/notify/crcgas_cis@fiberhome/query?username=LIUZHIBING5&password=Liuzhibing5&url=/pf_auth/staff/showStaffInfoById&isUrlParam=1&staffId='
			+retPmsload.resultValue.items[0].itemAcceptor;
		$.ajax({
			url : url,
			type : 'get',
			async: false,//使用同步的方式,true为异步方式
			success : function(data){
				let j={
					successful: true,
					resultValue: {
						items: [{
								itemNo: retPmsload.resultValue.items[0].itemNo,
								itemName: retQueryResultList.resultValue.items[0].itemName,
								acptBusiName: retPmsload.resultValue.items[0].acptBusiName,
								consAddr: retQueryResultList.resultValue.items[0].consAddr,
								contChanlNo: retQueryResultList.resultValue.items[0].contChanlNo,
								itemAcceptorName: retPmsload.resultValue.items[0].itemAcceptorName,
								custName: retQueryResultList.resultValue.items[0].custName,
								mobile: data.resultValue.items[0].mobile
							}
						]
					},
					resultHint: "获取工程信息成功"
				}
				$("#div").html(JSON.stringify(j))
			},
			fail:function(){
			},
		})
}
</script>
</head>
<body>
<div id="div"></div>
</body>
</html>
